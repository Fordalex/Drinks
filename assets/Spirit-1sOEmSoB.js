import{d as J,u as ae,r as S,e as v,z as ve,A as ye,I as Ve,B as he,C as ge,D as _e,f as ke,E as b,G as Se,H as we,J as Ce,a as t,K as q,F as E,L as te,M as xe,N as Fe,O as be,P as O,Q as $e,R as Re,S as Ue,_ as K,l as $,o as k,c as x,w as n,n as Pe,i as G,j as F,t as f,b as h,g as le,T as z,q as Te,s as Ie,v as Be,U as Ne,V as Ee,k as ze,h as L,x as Me,y as Ae}from"./index-ZPjkTawY.js";import{R as De,S as He,m as qe,b as Oe,u as Le,c as ie,f as je,d as Ge,e as Je,V as Ke,a as N,g as j}from"./VForm-B28uI9p0.js";import{V as Qe}from"./VCol-ZxcPkSNO.js";import{V as We}from"./VRating-CA6qmXHn.js";const Xe=J({name:"SpiritForm",props:{spirit:{type:Object,required:!1,default:()=>({name:"",description:"",image:"",rating:0,spirit_type_id:null,spirit_style_id:null})}},components:{RecordForm:De,SelectFromRequest:He},setup(e){ae();const m=["Vanilla","Caramel","Spicy","Fruity","Floral","Herbal","Smoky","Woody"],d=S([]),c=v(()=>!!e.spirit.id),r=v(()=>c.value?`https://api.fordsdevelopment.co.uk/drinks/spirits/${e.spirit.id}`:"https://api.fordsdevelopment.co.uk/drinks/spirits"),o=v(()=>c.value?"PUT":"POST");return{isEditMode:c,endpoint:r,method:o,handleSave:async y=>{console.log(`${c.value?"Updated":"Created"} record:`,y),window.location.reload()},items:m,value:d}}}),Ye=ve({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...qe(),...Oe()},"VTextarea"),Ze=ye()({name:"VTextarea",directives:{Intersect:Ve},inheritAttrs:!1,props:Ye(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,m){let{attrs:d,emit:c,slots:r}=m;const o=he(e,"modelValue"),{isFocused:s,focus:y,blur:i}=Le(e),l=v(()=>typeof e.counterValue=="function"?e.counterValue(o.value):(o.value||"").toString().length),R=v(()=>{if(d.maxlength)return d.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function ne(a,p){var u,V;!e.autofocus||!a||(V=(u=p[0].target)==null?void 0:u.focus)==null||V.call(u)}const Q=S(),U=S(),W=ge(""),P=S(),oe=v(()=>e.persistentPlaceholder||s.value||e.active);function M(){var a;P.value!==document.activeElement&&((a=P.value)==null||a.focus()),s.value||y()}function se(a){M(),c("click:control",a)}function re(a){c("mousedown:control",a)}function ue(a){a.stopPropagation(),M(),O(()=>{o.value="",$e(e["onClick:clear"],a)})}function de(a){var u;const p=a.target;if(o.value=p.value,(u=e.modelModifiers)!=null&&u.trim){const V=[p.selectionStart,p.selectionEnd];O(()=>{p.selectionStart=V[0],p.selectionEnd=V[1]})}}const w=S(),T=S(+e.rows),A=v(()=>["plain","underlined"].includes(e.variant));_e(()=>{e.autoGrow||(T.value=+e.rows)});function C(){e.autoGrow&&O(()=>{if(!w.value||!U.value)return;const a=getComputedStyle(w.value),p=getComputedStyle(U.value.$el),u=parseFloat(a.getPropertyValue("--v-field-padding-top"))+parseFloat(a.getPropertyValue("--v-input-padding-top"))+parseFloat(a.getPropertyValue("--v-field-padding-bottom")),V=w.value.scrollHeight,I=parseFloat(a.lineHeight),D=Math.max(parseFloat(e.rows)*I+u,parseFloat(p.getPropertyValue("--v-input-control-height"))),H=parseFloat(e.maxRows)*I+u||1/0,_=Ue(V??0,D,H);T.value=Math.floor((_-u)/I),W.value=Re(_)})}ke(C),b(o,C),b(()=>e.rows,C),b(()=>e.maxRows,C),b(()=>e.density,C);let g;return b(w,a=>{a?(g=new ResizeObserver(C),g.observe(w.value)):g==null||g.disconnect()}),Se(()=>{g==null||g.disconnect()}),we(()=>{const a=!!(r.counter||e.counter||e.counterValue),p=!!(a||r.details),[u,V]=Ce(d),{modelValue:I,...D}=ie.filterProps(e),H=je(e);return t(ie,q({ref:Q,modelValue:o.value,"onUpdate:modelValue":_=>o.value=_,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":A.value},e.class],style:e.style},u,D,{centerAffix:T.value===1&&!A.value,focused:s.value}),{...r,default:_=>{let{id:B,isDisabled:X,isDirty:Y,isReadonly:ce,isValid:me}=_;return t(Ge,q({ref:U,style:{"--v-textarea-control-height":W.value},onClick:se,onMousedown:re,"onClick:clear":ue,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},H,{id:B.value,active:oe.value||Y.value,centerAffix:T.value===1&&!A.value,dirty:Y.value||e.dirty,disabled:X.value,focused:s.value,error:me.value===!1}),{...r,default:pe=>{let{props:{class:Z,...ee}}=pe;return t(E,null,[e.prefix&&t("span",{class:"v-text-field__prefix"},[e.prefix]),te(t("textarea",q({ref:P,class:Z,value:o.value,onInput:de,autofocus:e.autofocus,readonly:ce.value,disabled:X.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:M,onBlur:i},ee,V),null),[[xe("intersect"),{handler:ne},null,{once:!0}]]),e.autoGrow&&te(t("textarea",{class:[Z,"v-textarea__sizer"],id:`${ee.id}-sizer`,"onUpdate:modelValue":fe=>o.value=fe,ref:w,readonly:!0,"aria-hidden":"true"},null),[[Fe,o.value]]),e.suffix&&t("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:p?_=>{var B;return t(E,null,[(B=r.details)==null?void 0:B.call(r,_),a&&t(E,null,[t("span",null,null),t(Je,{active:e.persistentCounter||s.value,value:l.value,max:R.value,disabled:e.disabled},r.counter)])])}:void 0})}),be({},Q,U,P)}});function et(e,m,d,c,r,o){const s=$("SelectFromRequest"),y=$("RecordForm");return k(),x(y,{record:e.spirit,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:n(({openDialog:i})=>[Pe(e.$slots,"trigger",{openDialog:i},()=>[t(G,{color:"primary"},{default:n(()=>[F(f(e.isEditMode?"Edit Spirit":"Add Spirit"),1)]),_:1})])]),title:n(()=>[h("span",null,f(e.isEditMode?"Edit Spirit":"Add New Spirit"),1)]),form:n(({record:i})=>[t(Ke,null,{default:n(()=>[t(N,{modelValue:i.name,"onUpdate:modelValue":l=>i.name=l,label:"Name",required:""},null,8,["modelValue","onUpdate:modelValue"]),t(Ze,{modelValue:i.description,"onUpdate:modelValue":l=>i.description=l,label:"Description",rows:"4",required:""},null,8,["modelValue","onUpdate:modelValue"]),t(N,{modelValue:i.image,"onUpdate:modelValue":l=>i.image=l,label:"Image"},null,8,["modelValue","onUpdate:modelValue"]),t(N,{modelValue:i.rating,"onUpdate:modelValue":l=>i.rating=l,label:"Rating"},null,8,["modelValue","onUpdate:modelValue"]),t(N,{modelValue:i.ppm,"onUpdate:modelValue":l=>i.ppm=l,label:"Ppm"},null,8,["modelValue","onUpdate:modelValue"]),t(s,{path:"spirit_types",key:"name",name:"spirit_type_id",modelValue:i.spirit_type_id,"onUpdate:modelValue":l=>i.spirit_type_id=l},null,8,["modelValue","onUpdate:modelValue"]),t(s,{path:"spirit_styles",key:"name",name:"spirit_style_id",modelValue:i.spirit_style_id,"onUpdate:modelValue":l=>i.spirit_style_id=l},null,8,["modelValue","onUpdate:modelValue"]),t(s,{path:"distilleries",key:"name",name:"distillery_id",multiple:!0,modelValue:i.distillery_ids,"onUpdate:modelValue":l=>i.distillery_ids=l},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const tt=K(Xe,[["render",et]]),it=J({name:"DistilleryLink",props:{distillery:{type:Object,required:!0}},setup(e){const m=S({...e.distillery}),d=v(()=>`https://api.fordsdevelopment.co.uk/drinks/distilleries/${e.distillery.id}`);return{distillery:m,endpoint:d}}}),at={class:"text-subtitle-1 spirit-factory"};function lt(e,m,d,c,r,o){const s=$("router-link");return k(),le("p",at,[t(z,{color:"black",icon:"mdi-factory",size:"large",class:"mr-2"}),t(s,{to:{name:"distillery",params:{id:e.distillery.id}}},{default:n(()=>[F(f(e.distillery.name),1)]),_:1},8,["to"])])}const nt=K(it,[["render",lt]]),ot=J({name:"Spirit",props:{spirit:{type:Object,required:!0}},components:{SpiritForm:tt,DistilleryLink:nt},setup(e){const m=S({...e.spirit}),d=ae(),c=v(()=>`https://api.fordsdevelopment.co.uk/drinks/spirits/${e.spirit.id}`),r=v(()=>`/Drinks/#/spirits/${e.spirit.id}`);return{editedSpirit:m,saveChanges:async({data:s,endpoint:y})=>{try{const i=await fetch(y,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d.accessToken}`},body:JSON.stringify(s)});if(!i.ok)throw new Error(`Error: ${i.status} - ${i.statusText}`);const l=await i.json();m.value=l,window.location.reload()}catch(i){console.error("Error saving spirit:",i)}},endpoint:c,spiritLink:r}}}),st={class:"image-container"},rt={class:"py-1"},ut={class:"py-1"},dt={class:"py-1"},ct={class:"py-1"};function mt(e,m,d,c,r,o){const s=$("SpiritForm"),y=$("DistilleryLink");return k(),x(Ae,null,{default:n(()=>[t(Qe,{cols:"12"},{default:n(()=>[t(s,{spirit:e.spirit},{trigger:n(({openDialog:i})=>[t(G,{density:"comfortable",icon:"mdi-dots-vertical",variant:"tonal",onClick:i},null,8,["onClick"])]),_:1},8,["spirit"])]),_:1}),h("div",st,[t(Te,{height:"250",src:e.spirit.image,contain:""},null,8,["src"])]),t(Ie,null,{default:n(()=>[t(Be,null,{default:n(()=>[F(f(e.spirit.name),1)]),_:1})]),_:1}),t(Ne,null,{default:n(()=>{var i,l;return[t(Ee,{align:"center",class:"mx-0"},{default:n(()=>[t(We,{"model-value":e.spirit.rating,color:"amber",density:"compact",size:"small",class:"mb-4","half-increments":"",readonly:""},null,8,["model-value"])]),_:1}),h("div",rt,[h("p",null,"Company: "+f((i=e.spirit.company)==null?void 0:i.name),1)]),h("div",ut,[h("p",null,"Brand: "+f((l=e.spirit.brand)==null?void 0:l.name),1)]),(k(!0),le(E,null,ze(e.spirit.distilleries,R=>(k(),x(y,{key:R.id,distillery:R},null,8,["distillery"]))),128)),h("div",dt,[e.spirit.spirit_type?(k(),x(j,{key:0,class:"mr-2 mt-2",color:e.spirit.spirit_type.colour,size:"small",label:""},{default:n(()=>[t(z,{icon:e.spirit.spirit_type.icon,start:""},null,8,["icon"]),F(" "+f(e.spirit.spirit_type.name),1)]),_:1},8,["color"])):L("",!0),e.spirit.spirit_style?(k(),x(j,{key:1,class:"mr-2 mt-2",color:e.spirit.spirit_style.colour,size:"small",label:""},{default:n(()=>[t(z,{icon:e.spirit.spirit_style.icon,start:""},null,8,["icon"]),F(" "+f(e.spirit.spirit_style.name),1)]),_:1},8,["color"])):L("",!0),e.spirit.ppm?(k(),x(j,{key:2,color:"#8c4f00",size:"small",class:"mt-2",label:""},{default:n(()=>[t(z,{icon:"mdi mdi-smoke",start:""}),F(" "+f(e.spirit.ppm),1)]),_:1})):L("",!0)]),h("div",ct,[h("div",null,f(e.spirit.description||"No description."),1)])]}),_:1}),t(Me,null,{default:n(()=>[t(G,{href:e.spiritLink,color:"deep-purple-lighten-2",text:"More",block:"",border:""},null,8,["href"])]),_:1})]),_:1})}const Vt=K(ot,[["render",mt]]);export{Vt as S,tt as a};
