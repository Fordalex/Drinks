import{d as D,u as b,r as T,e as y,_ as F,l as p,o as a,c as V,w as i,n as A,a as l,i as h,j as v,t as g,b as k,p as M,q as j,s as C,v as q,x as B,g as m,F as S,k as w,y as N,z as E,h as I,V as U}from"./index-DnvRLiit.js";import{R as O,S as P,V as z,a as f}from"./VForm-TVvqgWn1.js";import{S as G}from"./SpiritLink-Bnplj_k1.js";import{V as _}from"./VCol-mdlYBquf.js";import{M as H}from"./Map-68B2R_UU.js";import{V as J}from"./VContainer-BniP9kR8.js";const K=D({name:"DistilleryForm",props:{distillery:{type:Object,required:!1,default:()=>({name:"",image:""})}},components:{RecordForm:O,SelectFromRequest:P},setup(e){b();const r=T([]),n=y(()=>!!e.distillery.id),o=y(()=>n.value?`https://api.fordsdevelopment.co.uk/drinks/distilleries/${e.distillery.id}`:"https://api.fordsdevelopment.co.uk/drinks/distilleries"),d=y(()=>n.value?"PUT":"POST");return{isEditMode:n,endpoint:o,method:d,handleSave:async u=>{console.log(`${n.value?"Updated":"Created"} record:`,u),window.location.reload()},value:r}}});function Q(e,r,n,o,d,$){const u=p("SelectFromRequest"),c=p("RecordForm");return a(),V(c,{record:e.distillery,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:i(({openDialog:t})=>[A(e.$slots,"trigger",{openDialog:t},()=>[l(h,{color:"primary"},{default:i(()=>[v(g(e.isEditMode?"Edit Spirit":"Add Distillery"),1)]),_:1})])]),title:i(()=>[k("span",null,g(e.isEditMode?"Edit Distillery":"Add New Distillery"),1)]),form:i(({record:t})=>[l(z,null,{default:i(()=>[l(f,{modelValue:t.name,"onUpdate:modelValue":s=>t.name=s,label:"Name",required:""},null,8,["modelValue","onUpdate:modelValue"]),l(f,{modelValue:t.image_link,"onUpdate:modelValue":s=>t.image_link=s,label:"Image"},null,8,["modelValue","onUpdate:modelValue"]),l(f,{modelValue:t.lng,"onUpdate:modelValue":s=>t.lng=s,label:"Longitude"},null,8,["modelValue","onUpdate:modelValue"]),l(f,{modelValue:t.lat,"onUpdate:modelValue":s=>t.lat=s,label:"Latitude"},null,8,["modelValue","onUpdate:modelValue"]),l(u,{path:"regions",key:"name",name:"region_id",modelValue:t.region_id,"onUpdate:modelValue":s=>t.region_id=s},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const L=F(K,[["render",Q]]),W=D({name:"Distillery",props:{distillery:{type:Object,required:!0}},components:{DistilleryForm:L,SpiritLink:G},setup(e){return{distilleryLink:y(()=>`/Drinks/#/distilleries/${e.distillery.id}`)}}});function X(e,r,n,o,d,$){const u=p("DistilleryForm"),c=p("SpiritLink");return a(),V(E,null,{loader:i(({isActive:t})=>[l(M,{active:t,color:"deep-purple",height:"4",indeterminate:""},null,8,["active"])]),default:i(()=>[l(_,{cols:"12"},{default:i(()=>[l(u,{distillery:e.distillery},{trigger:i(({openDialog:t})=>[l(h,{density:"comfortable",icon:"mdi-dots-vertical",variant:"tonal",onClick:t},null,8,["onClick"])]),_:1},8,["distillery"])]),_:1}),l(j,{height:"250",src:e.distillery.image_link,cover:""},null,8,["src"]),l(C,null,{default:i(()=>{var t;return[l(q,null,{default:i(()=>[v(g(e.distillery.name),1)]),_:1}),k("p",null,"Region: "+g((t=e.distillery.region)==null?void 0:t.name),1)]}),_:1}),l(C,null,{default:i(()=>[l(B,null,{default:i(()=>r[0]||(r[0]=[v("Spirits")])),_:1}),(a(!0),m(S,null,w(e.distillery.spirits,t=>(a(),V(c,{key:t.id,spirit:t},null,8,["spirit"]))),128))]),_:1}),l(N,null,{default:i(()=>[l(h,{href:e.distilleryLink,color:"deep-purple-lighten-2",text:"More",block:"",border:""},null,8,["href"])]),_:1})]),_:1})}const Y=F(W,[["render",X]]),Z=D({name:"App",components:{Distillery:Y,Map:H,DistilleryForm:L},data(){return{distilleries:[],pins:[]}},mounted(){this.fetchDistilleries()},methods:{async fetchDistilleries(){const e=b(),n=await fetch("https://api.fordsdevelopment.co.uk/drinks/distilleries",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`}});if(n.ok)this.distilleries=await n.json(),this.pins=this.distilleries.filter(o=>{if(o.lat)return o}).map(o=>({lat:parseFloat(o.lat),lng:parseFloat(o.lng),body:`<h4>${o.name}</h4>
                <ul>
                  ${o.spirits.map(d=>`
                    <li>
                      <a href="/Drinks/#/spirits/${d.id}">${d.name}</a>
                    </li>
                  `).join("")}
                </ul>
          `}));else{const o=await n.json();console.error(o.error),o.error==="Access token has expired or is invalid."&&(console.log("Access token has expired or is invalid."),e.$reset(),e.clearState())}}}}),x={key:0},ee={key:0,class:"row m-0 g-2 p-2"},le={key:1};function te(e,r,n,o,d,$){const u=p("Map"),c=p("DistilleryForm"),t=p("Distillery");return a(),m(S,null,[e.pins.length>0?(a(),m("div",x,[l(u,{pins:e.pins},null,8,["pins"])])):I("",!0),k("main",null,[e.distilleries.length>0?(a(),m("div",ee,[l(J,null,{default:i(()=>[l(U,null,{default:i(()=>[l(_,{cols:"6"},{default:i(()=>r[0]||(r[0]=[k("h1",null,"Distilleries",-1)])),_:1}),l(_,{cols:"6",class:"text-right"},{default:i(()=>[l(c,{distillery:e.distillery},{trigger:i(({openDialog:s})=>[l(h,{density:"comfortable",variant:"tonal",text:"New Distillery",onClick:s},null,8,["onClick"])]),_:1},8,["distillery"])]),_:1})]),_:1}),l(U,null,{default:i(()=>[(a(!0),m(S,null,w(e.distilleries,(s,R)=>(a(),V(_,{cols:"12",sm:"3",key:R,distillery:s},{default:i(()=>[l(t,{distillery:s},null,8,["distillery"])]),_:2},1032,["distillery"]))),128))]),_:1})]),_:1})])):(a(),m("p",le,"Loading distilleries..."))])],64)}const de=F(Z,[["render",te]]);export{de as default};
