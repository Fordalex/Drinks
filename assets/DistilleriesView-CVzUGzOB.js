import{d as $,u as S,r as R,e as y,_ as v,l as p,o as d,c as D,w as t,n as T,a as l,i as _,j as U,t as V,b as g,p as A,q as L,s as M,v as j,x as q,y as B,g as c,h as N,F,V as C,k as E}from"./index-CXTJE7Gf.js";import{R as I,S as O,V as P,a as f}from"./VForm-E0dd8P_u.js";import{V as h}from"./VCol-CyUiFGvx.js";import{M as z}from"./Map-aiS5uI9i.js";import{V as G}from"./VContainer-Bjfcy4Zc.js";const H=$({name:"DistilleryForm",props:{distillery:{type:Object,required:!1,default:()=>({name:"",image:""})}},components:{RecordForm:I,SelectFromRequest:O},setup(e){S();const r=R([]),n=y(()=>!!e.distillery.id),i=y(()=>n.value?`https://api.fordsdevelopment.co.uk/drinks/distilleries/${e.distillery.id}`:"https://api.fordsdevelopment.co.uk/drinks/distilleries"),u=y(()=>n.value?"PUT":"POST");return{isEditMode:n,endpoint:i,method:u,handleSave:async m=>{console.log(`${n.value?"Updated":"Created"} record:`,m),window.location.reload()},value:r}}});function J(e,r,n,i,u,k){const m=p("SelectFromRequest"),a=p("RecordForm");return d(),D(a,{record:e.distillery,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:t(({openDialog:o})=>[T(e.$slots,"trigger",{openDialog:o},()=>[l(_,{color:"primary"},{default:t(()=>[U(V(e.isEditMode?"Edit Spirit":"Add Distillery"),1)]),_:1})])]),title:t(()=>[g("span",null,V(e.isEditMode?"Edit Distillery":"Add New Distillery"),1)]),form:t(({record:o})=>[l(P,null,{default:t(()=>[l(f,{modelValue:o.name,"onUpdate:modelValue":s=>o.name=s,label:"Name",required:""},null,8,["modelValue","onUpdate:modelValue"]),l(f,{modelValue:o.image_link,"onUpdate:modelValue":s=>o.image_link=s,label:"Image"},null,8,["modelValue","onUpdate:modelValue"]),l(f,{modelValue:o.lng,"onUpdate:modelValue":s=>o.lng=s,label:"Longitude"},null,8,["modelValue","onUpdate:modelValue"]),l(f,{modelValue:o.lat,"onUpdate:modelValue":s=>o.lat=s,label:"Latitude"},null,8,["modelValue","onUpdate:modelValue"]),l(m,{path:"regions",key:"name",name:"region_id",modelValue:o.region_id,"onUpdate:modelValue":s=>o.region_id=s},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const b=v(H,[["render",J]]),K=$({name:"Distillery",props:{distillery:{type:Object,required:!0}},components:{DistilleryForm:b},setup(e){return{distilleryLink:y(()=>`/Drinks/#/distilleries/${e.distillery.id}`)}}});function Q(e,r,n,i,u,k){const m=p("DistilleryForm");return d(),D(B,null,{loader:t(({isActive:a})=>[l(A,{active:a,color:"deep-purple",height:"4",indeterminate:""},null,8,["active"])]),default:t(()=>[l(h,{cols:"12"},{default:t(()=>[l(m,{distillery:e.distillery},{trigger:t(({openDialog:a})=>[l(_,{density:"comfortable",icon:"mdi-dots-vertical",variant:"tonal",onClick:a},null,8,["onClick"])]),_:1},8,["distillery"])]),_:1}),l(L,{height:"250",src:e.distillery.image_link,cover:""},null,8,["src"]),l(M,null,{default:t(()=>{var a;return[l(j,null,{default:t(()=>[U(V(e.distillery.name),1)]),_:1}),g("p",null,"Region: "+V((a=e.distillery.region)==null?void 0:a.name),1)]}),_:1}),l(q,null,{default:t(()=>[l(_,{href:e.distilleryLink,color:"deep-purple-lighten-2",text:"More",block:"",border:""},null,8,["href"])]),_:1})]),_:1})}const W=v(K,[["render",Q]]),X=$({name:"App",components:{Distillery:W,Map:z,DistilleryForm:b},data(){return{distilleries:[],pins:[]}},mounted(){this.fetchDistilleries()},methods:{async fetchDistilleries(){const e=S(),n=await fetch("https://api.fordsdevelopment.co.uk/drinks/distilleries",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`}});if(n.ok)this.distilleries=await n.json(),this.pins=this.distilleries.filter(i=>{if(i.lat)return i}).map(i=>({lat:parseFloat(i.lat),lng:parseFloat(i.lng),body:`<h4>${i.name}</h4>
                <ul>
                  ${i.spirits.map(u=>`
                    <li>
                      <a href="/Drinks/#/spirits/${u.id}">${u.name}</a>
                    </li>
                  `).join("")}
                </ul>
          `}));else{const i=await n.json();console.error(i.error),i.error==="Access token has expired or is invalid."&&(console.log("Access token has expired or is invalid."),e.$reset(),e.clearState())}}}}),Y={key:0},Z={key:0,class:"row m-0 g-2 p-2"},x={key:1};function ee(e,r,n,i,u,k){const m=p("Map"),a=p("DistilleryForm"),o=p("Distillery");return d(),c(F,null,[e.pins.length>0?(d(),c("div",Y,[l(m,{pins:e.pins},null,8,["pins"])])):N("",!0),g("main",null,[e.distilleries.length>0?(d(),c("div",Z,[l(G,null,{default:t(()=>[l(C,null,{default:t(()=>[l(h,{cols:"6"},{default:t(()=>r[0]||(r[0]=[g("h1",null,"Distilleries",-1)])),_:1}),l(h,{cols:"6",class:"text-right"},{default:t(()=>[l(a,{distillery:e.distillery},{trigger:t(({openDialog:s})=>[l(_,{density:"comfortable",variant:"tonal",text:"New Distillery",onClick:s},null,8,["onClick"])]),_:1},8,["distillery"])]),_:1})]),_:1}),l(C,null,{default:t(()=>[(d(!0),c(F,null,E(e.distilleries,(s,w)=>(d(),D(h,{cols:"12",sm:"3",key:w,distillery:s},{default:t(()=>[l(o,{distillery:s},null,8,["distillery"])]),_:2},1032,["distillery"]))),128))]),_:1})]),_:1})])):(d(),c("p",x,"Loading distilleries..."))])],64)}const ne=v(X,[["render",ee]]);export{ne as default};
