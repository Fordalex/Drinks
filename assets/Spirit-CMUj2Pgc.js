import{d as G,u as te,r as _,e as y,z as ve,A as ye,I as Ve,B as ge,C as he,D as _e,f as ke,E as F,G as Se,H as we,J as Ce,a as t,K as H,F as N,L as Z,M as xe,N as Fe,O as be,P as q,Q as $e,R as Re,S as Ue,_ as L,l as b,o as h,c as C,w as s,n as Pe,i as ae,j as x,t as k,b as B,g as le,T as E,q as Te,s as Ie,v as Ne,U as Be,V as Ee,k as ze,h as O,y as Me}from"./index-Cf_Eq9Ee.js";import{R as Ae,S as De,m as He,b as qe,u as Oe,c as ee,f as je,d as Ge,e as Le,V as Je,a as I,g as j}from"./VForm-CB86sKhj.js";import{V as Ke}from"./VCol-C7if13jv.js";import{V as Qe}from"./VRating-BZ4LjMjr.js";const We=G({name:"SpiritForm",props:{spirit:{type:Object,required:!1,default:()=>({name:"",description:"",image:"",rating:0,spirit_type_id:null,spirit_style_id:null})}},components:{RecordForm:Ae,SelectFromRequest:De},setup(e){te();const p=["Vanilla","Caramel","Spicy","Fruity","Floral","Herbal","Smoky","Woody"],c=_([]),m=y(()=>!!e.spirit.id),r=y(()=>m.value?`https://api.fordsdevelopment.co.uk/drinks/spirits/${e.spirit.id}`:"https://api.fordsdevelopment.co.uk/drinks/spirits"),i=y(()=>m.value?"PUT":"POST");return{isEditMode:m,endpoint:r,method:i,handleSave:async u=>{console.log(`${m.value?"Updated":"Created"} record:`,u),window.location.reload()},items:p,value:c}}}),Xe=ve({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...He(),...qe()},"VTextarea"),Ye=ye()({name:"VTextarea",directives:{Intersect:Ve},inheritAttrs:!1,props:Xe(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,p){let{attrs:c,emit:m,slots:r}=p;const i=ge(e,"modelValue"),{isFocused:o,focus:u,blur:a}=Oe(e),n=y(()=>typeof e.counterValue=="function"?e.counterValue(i.value):(i.value||"").toString().length),ie=y(()=>{if(c.maxlength)return c.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function ne(l,f){var d,v;!e.autofocus||!l||(v=(d=f[0].target)==null?void 0:d.focus)==null||v.call(d)}const J=_(),$=_(),K=he(""),R=_(),oe=y(()=>e.persistentPlaceholder||o.value||e.active);function z(){var l;R.value!==document.activeElement&&((l=R.value)==null||l.focus()),o.value||u()}function se(l){z(),m("click:control",l)}function re(l){m("mousedown:control",l)}function ue(l){l.stopPropagation(),z(),q(()=>{i.value="",$e(e["onClick:clear"],l)})}function de(l){var d;const f=l.target;if(i.value=f.value,(d=e.modelModifiers)!=null&&d.trim){const v=[f.selectionStart,f.selectionEnd];q(()=>{f.selectionStart=v[0],f.selectionEnd=v[1]})}}const S=_(),U=_(+e.rows),M=y(()=>["plain","underlined"].includes(e.variant));_e(()=>{e.autoGrow||(U.value=+e.rows)});function w(){e.autoGrow&&q(()=>{if(!S.value||!$.value)return;const l=getComputedStyle(S.value),f=getComputedStyle($.value.$el),d=parseFloat(l.getPropertyValue("--v-field-padding-top"))+parseFloat(l.getPropertyValue("--v-input-padding-top"))+parseFloat(l.getPropertyValue("--v-field-padding-bottom")),v=S.value.scrollHeight,P=parseFloat(l.lineHeight),A=Math.max(parseFloat(e.rows)*P+d,parseFloat(f.getPropertyValue("--v-input-control-height"))),D=parseFloat(e.maxRows)*P+d||1/0,g=Ue(v??0,A,D);U.value=Math.floor((g-d)/P),K.value=Re(g)})}ke(w),F(i,w),F(()=>e.rows,w),F(()=>e.maxRows,w),F(()=>e.density,w);let V;return F(S,l=>{l?(V=new ResizeObserver(w),V.observe(S.value)):V==null||V.disconnect()}),Se(()=>{V==null||V.disconnect()}),we(()=>{const l=!!(r.counter||e.counter||e.counterValue),f=!!(l||r.details),[d,v]=Ce(c),{modelValue:P,...A}=ee.filterProps(e),D=je(e);return t(ee,H({ref:J,modelValue:i.value,"onUpdate:modelValue":g=>i.value=g,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":M.value},e.class],style:e.style},d,A,{centerAffix:U.value===1&&!M.value,focused:o.value}),{...r,default:g=>{let{id:T,isDisabled:Q,isDirty:W,isReadonly:ce,isValid:me}=g;return t(Ge,H({ref:$,style:{"--v-textarea-control-height":K.value},onClick:se,onMousedown:re,"onClick:clear":ue,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},D,{id:T.value,active:oe.value||W.value,centerAffix:U.value===1&&!M.value,dirty:W.value||e.dirty,disabled:Q.value,focused:o.value,error:me.value===!1}),{...r,default:pe=>{let{props:{class:X,...Y}}=pe;return t(N,null,[e.prefix&&t("span",{class:"v-text-field__prefix"},[e.prefix]),Z(t("textarea",H({ref:R,class:X,value:i.value,onInput:de,autofocus:e.autofocus,readonly:ce.value,disabled:Q.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:z,onBlur:a},Y,v),null),[[xe("intersect"),{handler:ne},null,{once:!0}]]),e.autoGrow&&Z(t("textarea",{class:[X,"v-textarea__sizer"],id:`${Y.id}-sizer`,"onUpdate:modelValue":fe=>i.value=fe,ref:S,readonly:!0,"aria-hidden":"true"},null),[[Fe,i.value]]),e.suffix&&t("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:f?g=>{var T;return t(N,null,[(T=r.details)==null?void 0:T.call(r,g),l&&t(N,null,[t("span",null,null),t(Le,{active:e.persistentCounter||o.value,value:n.value,max:ie.value,disabled:e.disabled},r.counter)])])}:void 0})}),be({},J,$,R)}});function Ze(e,p,c,m,r,i){const o=b("SelectFromRequest"),u=b("RecordForm");return h(),C(u,{record:e.spirit,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:s(({openDialog:a})=>[Pe(e.$slots,"trigger",{openDialog:a},()=>[t(ae,{color:"primary"},{default:s(()=>[x(k(e.isEditMode?"Edit Spirit":"Add Spirit"),1)]),_:1})])]),title:s(()=>[B("span",null,k(e.isEditMode?"Edit Spirit":"Add New Spirit"),1)]),form:s(({record:a})=>[t(Je,null,{default:s(()=>[t(I,{modelValue:a.name,"onUpdate:modelValue":n=>a.name=n,label:"Name",required:""},null,8,["modelValue","onUpdate:modelValue"]),t(Ye,{modelValue:a.description,"onUpdate:modelValue":n=>a.description=n,label:"Description",rows:"4",required:""},null,8,["modelValue","onUpdate:modelValue"]),t(I,{modelValue:a.image,"onUpdate:modelValue":n=>a.image=n,label:"Image"},null,8,["modelValue","onUpdate:modelValue"]),t(I,{modelValue:a.rating,"onUpdate:modelValue":n=>a.rating=n,label:"Rating"},null,8,["modelValue","onUpdate:modelValue"]),t(I,{modelValue:a.ppm,"onUpdate:modelValue":n=>a.ppm=n,label:"Ppm"},null,8,["modelValue","onUpdate:modelValue"]),t(o,{path:"spirit_types",key:"name",name:"spirit_type_id",modelValue:a.spirit_type_id,"onUpdate:modelValue":n=>a.spirit_type_id=n},null,8,["modelValue","onUpdate:modelValue"]),t(o,{path:"spirit_styles",key:"name",name:"spirit_style_id",modelValue:a.spirit_style_id,"onUpdate:modelValue":n=>a.spirit_style_id=n},null,8,["modelValue","onUpdate:modelValue"]),t(o,{path:"distilleries",key:"name",name:"distillery_id",multiple:!0,modelValue:a.distillery_ids,"onUpdate:modelValue":n=>a.distillery_ids=n},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const et=L(We,[["render",Ze]]),tt=G({name:"DistilleryLink",props:{distillery:{type:Object,required:!0}},setup(e){const p=_({...e.distillery}),c=y(()=>`https://api.fordsdevelopment.co.uk/drinks/distilleries/${e.distillery.id}`);return{distillery:p,endpoint:c}}}),at={class:"text-subtitle-1 spirit-factory"};function lt(e,p,c,m,r,i){const o=b("router-link");return h(),le("p",at,[t(E,{color:"black",icon:"mdi-factory",size:"large",class:"mr-2"}),t(o,{to:{name:"distillery",params:{id:e.distillery.id}}},{default:s(()=>[x(k(e.distillery.name),1)]),_:1},8,["to"])])}const it=L(tt,[["render",lt]]),nt=G({name:"Spirit",props:{spirit:{type:Object,required:!0}},components:{SpiritForm:et,DistilleryLink:it},setup(e){const p=_({...e.spirit}),c=te(),m=y(()=>`https://api.fordsdevelopment.co.uk/drinks/spirits/${e.spirit.id}`);return{editedSpirit:p,saveChanges:async({data:i,endpoint:o})=>{try{const u=await fetch(o,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.accessToken}`},body:JSON.stringify(i)});if(!u.ok)throw new Error(`Error: ${u.status} - ${u.statusText}`);const a=await u.json();p.value=a,window.location.reload()}catch(u){console.error("Error saving spirit:",u)}},endpoint:m}}}),ot={class:"image-container"};function st(e,p,c,m,r,i){const o=b("SpiritForm"),u=b("DistilleryLink");return h(),C(Me,null,{default:s(()=>[t(Ke,{cols:"12"},{default:s(()=>[t(o,{spirit:e.spirit},{trigger:s(({openDialog:a})=>[t(ae,{density:"comfortable",icon:"mdi-dots-vertical",variant:"tonal",onClick:a},null,8,["onClick"])]),_:1},8,["spirit"])]),_:1}),B("div",ot,[t(Te,{height:"250",src:e.spirit.image,contain:""},null,8,["src"])]),t(Ie,null,{default:s(()=>[t(Ne,null,{default:s(()=>[x(k(e.spirit.name),1)]),_:1})]),_:1}),t(Be,null,{default:s(()=>[t(Ee,{align:"center",class:"mx-0"},{default:s(()=>[t(Qe,{"model-value":e.spirit.rating,color:"amber",density:"compact",size:"small",class:"mb-4","half-increments":"",readonly:""},null,8,["model-value"])]),_:1}),(h(!0),le(N,null,ze(e.spirit.distilleries,a=>(h(),C(u,{key:a.id,distillery:a},null,8,["distillery"]))),128)),B("div",null,[e.spirit.spirit_type?(h(),C(j,{key:0,class:"mb-2 mr-2 mt-3",color:e.spirit.spirit_type.colour,size:"small",label:""},{default:s(()=>[t(E,{icon:e.spirit.spirit_type.icon,start:""},null,8,["icon"]),x(" "+k(e.spirit.spirit_type.name),1)]),_:1},8,["color"])):O("",!0),e.spirit.spirit_style?(h(),C(j,{key:1,class:"mb-2 mr-2",color:e.spirit.spirit_style.colour,size:"small",label:""},{default:s(()=>[t(E,{icon:e.spirit.spirit_style.icon,start:""},null,8,["icon"]),x(" "+k(e.spirit.spirit_style.name),1)]),_:1},8,["color"])):O("",!0),e.spirit.ppm?(h(),C(j,{key:2,class:"mb-2",color:"#8c4f00",size:"small",label:""},{default:s(()=>[t(E,{icon:"mdi mdi-smoke",start:""}),x(" "+k(e.spirit.ppm),1)]),_:1})):O("",!0)]),B("div",null,k(e.spirit.description||"No description."),1)]),_:1})]),_:1})}const mt=L(nt,[["render",st]]);export{mt as S,et as a};
